
if command -v brew &>/dev/null; then
  BREW_PREFIX=`brew --prefix`

  if [ -f $BREW_PREFIX/etc/bash_completion ]; then
    source $BREW_PREFIX/etc/bash_completion
  fi

  if [ -f $BREW_PREFIX/etc/profile.d/autojump.sh ]; then
    source $BREW_PREFIX/etc/profile.d/autojump.sh
  fi

  if [ -f $BREW_PREFIX/opt/chruby/share/chruby/chruby.sh ]; then
    source $BREW_PREFIX/opt/chruby/share/chruby/chruby.sh
  fi

  if [ -f $BREW_PREFIX/opt/chruby/share/chruby/auto.sh ]; then
    source $BREW_PREFIX/opt/chruby/share/chruby/auto.sh
  fi
fi

# Git aliases completition
function _git_complete_aliases {
  local cmd shortcmd=${COMP_WORDS[0]} al old_comp_words

  # Retrieve full command for alias
  al=`alias $shortcmd`
  cmd=( ${al:(( ${#shortcmd} + 8 )):(( ${#al} - ${#shortcmd} - 9 ))} )

  # Replace short command (alias) with the full command
  COMP_WORDS=( ${cmd[@]} ${COMP_WORDS[@]:1} )
  # Shift current word index, because we have inserted something
  # in the beginning of command
  (( COMP_CWORD+=${#cmd[@]}-1 ))
  _git
}

for cmd in 'ga gb gc gcb gd gci gca gl glr gm gmt gp gull gush gcam gg'; do
  complete -o bashdefault -o default -o nospace -F _git_complete_aliases $cmd 2>/dev/null \
    || complete -o default -o nospace -F _git_complete_aliases $cmd 2>/dev/null
done

complete -o default -F _command be
